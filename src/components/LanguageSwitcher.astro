---
// Language Switcher Component
---

<button id="language-toggle" class="language-toggle" aria-label="Toggle Language">
  <span class="lang-text">EN</span>
</button>

<style>
  .language-toggle {
    background: none;
    border: 2px solid var(--color-border);
    border-radius: 6px;
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--color-text);
    min-width: 50px;
  }

  .language-toggle:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
    transform: translateY(-1px);
  }

  .lang-text {
    font-family: 'Inter', sans-serif;
    letter-spacing: 0.5px;
  }

  .dark .language-toggle {
    border-color: #4b5563;
    color: #f3f4f6;
  }

  .dark .language-toggle:hover {
    border-color: #fbbf24;
    color: #fbbf24;
  }
</style>

<script>
  // Language persistence and switching
  const getLanguage = (): string => {
    if (typeof localStorage !== 'undefined') {
      return localStorage.getItem('language') || 'en';
    }
    return 'en';
  };

  const setLanguage = (lang: string) => {
    if (typeof localStorage !== 'undefined') {
      localStorage.setItem('language', lang);
    }
    document.documentElement.setAttribute('data-language', lang);
    updateLanguageDisplay();

    // Dispatch custom event to notify page components
    window.dispatchEvent(new CustomEvent('languagechange', { detail: { language: lang } }));
  };

  const updateLanguageDisplay = () => {
    const lang = getLanguage();
    const langText = document.querySelector('.lang-text');
    if (langText) {
      langText.textContent = lang === 'ko' ? '한글' : 'EN';
    }
  };

  const toggleLanguage = () => {
    const currentLang = getLanguage();
    const newLang = currentLang === 'en' ? 'ko' : 'en';
    setLanguage(newLang);
  };

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', () => {
    const savedLang = getLanguage();
    document.documentElement.setAttribute('data-language', savedLang);
    updateLanguageDisplay();
  });

  // Toggle on button click
  const toggleButton = document.getElementById('language-toggle');
  if (toggleButton) {
    toggleButton.addEventListener('click', toggleLanguage);
  }

  // Re-initialize on page navigation (for Astro view transitions)
  document.addEventListener('astro:page-load', () => {
    const savedLang = getLanguage();
    document.documentElement.setAttribute('data-language', savedLang);
    updateLanguageDisplay();

    const newToggleButton = document.getElementById('language-toggle');
    if (newToggleButton) {
      newToggleButton.addEventListener('click', toggleLanguage);
    }
  });
</script>
