---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PublicationCard from '../../components/PublicationCard.astro';
import StatItem from '../../components/StatItem.astro';
import publicationsData from '../../data/publications.json';

// Markdown publications 가져오기
const allPublications = await getCollection('publications');

// JSON에서 scholarStats와 citationGraph 가져오기
const scholarStats = publicationsData.scholarStats || {
  citations: 0,
  hIndex: 0,
  i10Index: 0
};
const citationGraph = publicationsData.citationGraph || [];
const domesticPublications = publicationsData.domestic_publications || [];

// Markdown publications를 JSON과 동일한 형식으로 변환
const publications = allPublications.map(pub => ({
  id: pub.slug,
  ...pub.data,
}));

// status별로 그룹핑
const workInProgress = publications
  .filter(p => p.status === 'work-in-progress')
  .sort((a, b) => b.year - a.year);

const workingPapers = publications
  .filter(p => p.status === 'working-paper')
  .sort((a, b) => b.year - a.year);

const publishedPapers = publications
  .filter(p => p.status === 'published')
  .sort((a, b) => b.year - a.year);

// 한국어 논문 정렬 (인용수 높은 순)
const domesticPapers = domesticPublications
  .sort((a, b) => b.citations - a.citations);

const pageTitle = "Research - Yonghee Kim";

// 현재 날짜
const currentDate = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
---

<BaseLayout title={pageTitle}>
  <style>
    .research-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 3rem 1.5rem;
      line-height: 1.625;
    }

    /* Header */
    .page-header {
      margin-bottom: 3rem;
    }

    .page-title {
      font-family: 'Paperozi', 'Merriweather', serif;
      font-size: 3rem;
      font-weight: 400;
      color: #1e40af;
      margin-bottom: 1rem;
    }

    .page-description {
      font-size: 1.125rem;
      color: #666;
      line-height: 1.6;
    }

    /* Profiles Grid */
    .profiles-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      margin-bottom: 3rem;
    }

    @media (min-width: 1024px) {
      .profiles-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    /* Google Scholar Stats */
    .scholar-section {
      background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 2rem;
    }

    /* ORCID Section */
    .orcid-section {
      background: linear-gradient(135deg, #f8fafc 0%, #f0fdf4 100%);
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 2rem;
    }

    .scholar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .scholar-title {
      font-family: 'Paperozi', 'Merriweather', serif;
      font-size: 1.25rem;
      font-weight: 600;
      color: #1e40af;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .scholar-link {
      color: #2563eb;
      text-decoration: none;
      font-size: 0.9375rem;
      font-weight: 500;
      transition: color 0.2s;
    }

    .scholar-link:hover {
      color: #1e40af;
      text-decoration: underline;
    }

    .scholar-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1.5rem;
    }

    .stat-updated {
      font-size: 0.8125rem;
      color: #94a3b8;
      text-align: center;
      margin-top: 1rem;
    }

    /* Citation Graph */
    .citation-graph {
      margin-top: 2rem;
      padding: 1.5rem;
      background: white;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }

    .graph-title {
      font-size: 1rem;
      font-weight: 600;
      color: #1e40af;
      margin-bottom: 1rem;
    }

    #citationChart {
      max-height: 300px;
    }

    /* Section Divider */
    .section-divider {
      border: none;
      border-top: 2px solid #e2e8f0;
      margin: 3rem 0;
    }

    /* Sort Controls */
    .sort-controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .sort-label {
      font-size: 0.9375rem;
      color: #6b7280;
      font-weight: 500;
    }

    .sort-button {
      padding: 0.5rem 1rem;
      border: 1px solid #e2e8f0;
      background: white;
      border-radius: 6px;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
      color: #4b5563;
    }

    .sort-button:hover {
      border-color: #2563eb;
      color: #2563eb;
    }

    .sort-button.active {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }

    /* Section Styles */
    .research-section {
      margin-bottom: 3rem;
    }

    .section-title {
      font-family: 'Paperozi', 'Merriweather', serif;
      font-size: 2rem;
      font-weight: 600;
      color: #1e40af;
      margin-bottom: 0.5rem;
    }

    .section-description {
      font-size: 1rem;
      color: #6b7280;
      margin-bottom: 2rem;
    }

    .publication-list {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    /* ORCID Content */
    .orcid-content {
      margin-top: 1.5rem;
    }

    .orcid-id-display {
      background: white;
      border: 2px solid #a6ce39;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .orcid-id-label {
      font-size: 0.875rem;
      color: #6b7280;
      font-weight: 600;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .orcid-id-value {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1e40af;
      font-family: 'Monaco', 'Courier New', monospace;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .orcid-info {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .orcid-info-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
    }

    .orcid-info-icon {
      flex-shrink: 0;
      color: #10b981;
    }

    .orcid-info-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.25rem;
    }

    .orcid-info-text {
      font-size: 0.8125rem;
      color: #6b7280;
      line-height: 1.4;
    }

    .orcid-badge {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 1rem;
      background: white;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      font-size: 0.8125rem;
      color: #6b7280;
      text-align: center;
    }

    .orcid-badge img {
      width: 16px;
      height: 16px;
    }

    /* Domestic Publications */
    .domestic-pub-item {
      padding: 1.5rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
      transition: all 0.2s;
    }

    .domestic-pub-item:hover {
      border-color: #2563eb;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .pub-header {
      margin-bottom: 1rem;
    }

    .pub-title-ko {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.5rem;
      line-height: 1.4;
    }

    .pub-title-en {
      font-size: 1rem;
      color: #6b7280;
      font-style: italic;
      margin: 0;
    }

    .pub-meta {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: #4b5563;
      margin-bottom: 1rem;
    }

    .pub-authors {
      font-weight: 500;
    }

    .pub-separator {
      color: #9ca3af;
    }

    .pub-journal-ko {
      font-weight: 500;
      color: #2563eb;
    }

    .pub-journal-en {
      color: #6b7280;
      font-size: 0.8125rem;
    }

    .pub-abstract {
      background: #f9fafb;
      padding: 1rem;
      border-left: 3px solid #2563eb;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      color: #4b5563;
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .pub-footer {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .pub-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      border-radius: 9999px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .pub-badge-kci {
      background: #dbeafe;
      color: #1e40af;
    }

    .pub-citations {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.875rem;
      color: #6b7280;
    }

    .pub-citations svg {
      flex-shrink: 0;
    }

    /* Responsive */
    @media (max-width: 640px) {
      .page-title {
        font-size: 2rem;
      }

      .scholar-stats {
        grid-template-columns: repeat(3, 1fr);
      }

      .orcid-id-value {
        font-size: 1rem;
      }

      .pub-title-ko {
        font-size: 1.125rem;
      }

      .pub-meta {
        font-size: 0.8125rem;
      }
    }
  </style>

  <div class="research-container">
    <!-- Header -->
    <header class="page-header">
      <h1 class="page-title" data-lang="en">Research</h1>
      <h1 class="page-title" data-lang="ko">연구</h1>
      <p class="page-description" data-lang="en">
        Academic research in media policy, digital platform regulation, and media economics.
      </p>
      <p class="page-description" data-lang="ko">
        미디어 정책, 디지털 플랫폼 규제, 미디어 경제학 분야의 학술 연구.
      </p>
    </header>

    <!-- Research Profiles Grid -->
    <div class="profiles-grid">
      <!-- Google Scholar Stats -->
      <section class="scholar-section">
        <div class="scholar-header">
          <h2 class="scholar-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
            Google Scholar
          </h2>
          <a href="https://scholar.google.com/citations?user=semkeskAAAAJ" target="_blank" class="scholar-link">
            <span data-lang="en">View Profile ↗</span>
            <span data-lang="ko">프로필 보기 ↗</span>
          </a>
        </div>
        <div class="scholar-stats">
          <span data-lang="en">
            <StatItem
              value={scholarStats.citations}
              label="Citations"
              sublabel="All time"
              align="center"
            />
          </span>
          <span data-lang="ko" style="text-align: center;">
            <div style="font-size: 2rem; font-weight: 600; color: #1e40af;">{scholarStats.citations}</div>
            <div style="font-size: 0.875rem; color: #6b7280; font-weight: 600;">인용</div>
            <div style="font-size: 0.75rem; color: #9ca3af;">전체</div>
          </span>

          <span data-lang="en">
            <StatItem
              value={scholarStats.hIndex}
              label="h-index"
              sublabel="All time"
              align="center"
            />
          </span>
          <span data-lang="ko" style="text-align: center;">
            <div style="font-size: 2rem; font-weight: 600; color: #1e40af;">{scholarStats.hIndex}</div>
            <div style="font-size: 0.875rem; color: #6b7280; font-weight: 600;">h-지수</div>
            <div style="font-size: 0.75rem; color: #9ca3af;">전체</div>
          </span>

          <span data-lang="en">
            <StatItem
              value={scholarStats.i10Index}
              label="i10-index"
              sublabel="All time"
              align="center"
            />
          </span>
          <span data-lang="ko" style="text-align: center;">
            <div style="font-size: 2rem; font-weight: 600; color: #1e40af;">{scholarStats.i10Index}</div>
            <div style="font-size: 0.875rem; color: #6b7280; font-weight: 600;">i10-지수</div>
            <div style="font-size: 0.75rem; color: #9ca3af;">전체</div>
          </span>
        </div>

        {citationGraph.length > 0 && (
          <div class="citation-graph">
            <h3 class="graph-title" data-lang="en">Citations by Year</h3>
            <h3 class="graph-title" data-lang="ko">연도별 인용</h3>
            <canvas id="citationChart"></canvas>
          </div>
        )}

        <p class="stat-updated" data-lang="en">Last updated: {currentDate}</p>
        <p class="stat-updated" data-lang="ko">최종 업데이트: {currentDate}</p>
      </section>

      <!-- ORCID Profile -->
      <section class="orcid-section">
        <div class="scholar-header">
          <h2 class="scholar-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" fill="currentColor">
              <path d="M256 128c0 70.7-57.3 128-128 128S0 198.7 0 128 57.3 0 128 0s128 57.3 128 128zM86.4 186.8V70.7h18.7v116.1H86.4zm119.8-47.6c0-23.7-14.8-39.2-37.2-39.2-22.4 0-37.2 15.5-37.2 39.2s14.8 39.2 37.2 39.2c22.4 0 37.2-15.5 37.2-39.2zm-18.2 0c0 14.8-7.6 24.5-19 24.5s-19-9.7-19-24.5 7.6-24.5 19-24.5 19 9.7 19 24.5zM86.4 46.8c0-6.1 4.9-11 11-11s11 4.9 11 11-4.9 11-11 11-11-4.9-11-11z"/>
            </svg>
            ORCID
          </h2>
          <a href="https://orcid.org/0000-0002-5643-2748" target="_blank" class="scholar-link">
            <span data-lang="en">View Profile ↗</span>
            <span data-lang="ko">프로필 보기 ↗</span>
          </a>
        </div>

        <div class="orcid-content">
          <div class="orcid-id-display">
            <div class="orcid-id-label" data-lang="en">Verified Researcher ID</div>
            <div class="orcid-id-label" data-lang="ko">검증된 연구자 ID</div>
            <div class="orcid-id-value">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" fill="#a6ce39">
                <path d="M256 128c0 70.7-57.3 128-128 128S0 198.7 0 128 57.3 0 128 0s128 57.3 128 128zM86.4 186.8V70.7h18.7v116.1H86.4zm119.8-47.6c0-23.7-14.8-39.2-37.2-39.2-22.4 0-37.2 15.5-37.2 39.2s14.8 39.2 37.2 39.2c22.4 0 37.2-15.5 37.2-39.2zm-18.2 0c0 14.8-7.6 24.5-19 24.5s-19-9.7-19-24.5 7.6-24.5 19-24.5 19 9.7 19 24.5zM86.4 46.8c0-6.1 4.9-11 11-11s11 4.9 11 11-4.9 11-11 11-11-4.9-11-11z"/>
              </svg>
              0000-0002-5643-2748
            </div>
          </div>

          <div class="orcid-info">
            <div class="orcid-info-item">
              <div class="orcid-info-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 11l3 3L22 4"></path>
                  <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                </svg>
              </div>
              <div>
                <div class="orcid-info-label" data-lang="en">Official Registry</div>
                <div class="orcid-info-label" data-lang="ko">공식 등록소</div>
                <div class="orcid-info-text" data-lang="en">Persistent digital identifier for researchers</div>
                <div class="orcid-info-text" data-lang="ko">연구자를 위한 영구 디지털 식별자</div>
              </div>
            </div>

            <div class="orcid-info-item">
              <div class="orcid-info-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
              </div>
              <div>
                <div class="orcid-info-label" data-lang="en">Verified Works</div>
                <div class="orcid-info-label" data-lang="ko">검증된 연구물</div>
                <div class="orcid-info-text" data-lang="en">Publications validated by publishers</div>
                <div class="orcid-info-text" data-lang="ko">출판사가 검증한 출판물</div>
              </div>
            </div>

            <div class="orcid-info-item">
              <div class="orcid-info-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M12 6v6l4 2"></path>
                </svg>
              </div>
              <div>
                <div class="orcid-info-label" data-lang="en">ResearcherID</div>
                <div class="orcid-info-label" data-lang="ko">리서처ID</div>
                <div class="orcid-info-text">G-5295-2018</div>
              </div>
            </div>
          </div>

          <div class="orcid-badge">
            <img src="https://orcid.org/sites/default/files/images/orcid_16x16.png" alt="ORCID iD icon" />
            <span data-lang="en">International standard for researcher identification</span>
            <span data-lang="ko">연구자 식별을 위한 국제 표준</span>
          </div>
        </div>
      </section>
    </div>

    <hr class="section-divider" />

    <!-- Published Papers -->
    <section class="research-section">
      <h2 class="section-title" data-lang="en">Published Papers</h2>
      <h2 class="section-title" data-lang="ko">게재 논문</h2>
      <p class="section-description" data-lang="en">Peer-reviewed publications in academic journals</p>
      <p class="section-description" data-lang="ko">학술지 게재 논문</p>

      <div class="sort-controls">
        <span class="sort-label" data-lang="en">Sort by:</span>
        <span class="sort-label" data-lang="ko">정렬:</span>
        <button class="sort-button active" data-sort="year">
          <span data-lang="en">Year (newest)</span>
          <span data-lang="ko">연도순 (최신)</span>
        </button>
        <button class="sort-button" data-sort="citations">
          <span data-lang="en">Citations (highest)</span>
          <span data-lang="ko">인용순 (많은순)</span>
        </button>
      </div>

      <div class="publication-list" id="publication-list">
        {publishedPapers.map((pub) => (
          <div class="publication-item" data-year={pub.year} data-citations={pub.citations || 0}>
            <PublicationCard
              publication={pub}
              variant="full"
              showAbstract={true}
              showBadges={true}
              showLinks={true}
            />
          </div>
        ))}
      </div>
    </section>

    <hr class="section-divider" />

    <!-- Work in Progress -->
    {workInProgress.length > 0 && (
      <>
        <section class="research-section">
          <h2 class="section-title" data-lang="en">Work in Progress</h2>
          <h2 class="section-title" data-lang="ko">진행중인 연구</h2>
          <p class="section-description" data-lang="en">Research projects currently under development</p>
          <p class="section-description" data-lang="ko">현재 진행중인 연구 프로젝트</p>
          <div class="publication-list">
            {workInProgress.map((pub) => (
              <PublicationCard
                publication={pub}
                variant="full"
                showAbstract={true}
                showBadges={true}
                showLinks={false}
              />
            ))}
          </div>
        </section>
        <hr class="section-divider" />
      </>
    )}

    <!-- Working Papers -->
    {workingPapers.length > 0 && (
      <>
        <section class="research-section">
          <h2 class="section-title" data-lang="en">Working Papers</h2>
          <h2 class="section-title" data-lang="ko">워킹 페이퍼</h2>
          <p class="section-description" data-lang="en">Research papers under review or revision</p>
          <p class="section-description" data-lang="ko">심사중이거나 수정중인 연구 논문</p>
          <div class="publication-list">
            {workingPapers.map((pub) => (
              <PublicationCard
                publication={pub}
                variant="full"
                showAbstract={true}
                showBadges={true}
                showLinks={false}
              />
            ))}
          </div>
        </section>
        <hr class="section-divider" />
      </>
    )}

    <!-- Domestic Publications (Korean) -->
    {domesticPapers.length > 0 && (
      <section class="research-section">
        <h2 class="section-title" data-lang="en">Domestic Publications (Korean)</h2>
        <h2 class="section-title" data-lang="ko">국내 학술지 논문</h2>
        <p class="section-description" data-lang="en">Publications in Korean academic journals (KCI)</p>
        <p class="section-description" data-lang="ko">한국어 학술지 게재 논문 (KCI 등재)</p>
        <div class="publication-list">
          {domesticPapers.map((pub) => (
            <div class="domestic-pub-item">
              <div class="pub-header">
                <h3 class="pub-title-ko">{pub.title}</h3>
                {pub.title_en && <p class="pub-title-en">{pub.title_en}</p>}
              </div>
              <div class="pub-meta">
                <span class="pub-authors">{pub.authors.join(', ')}</span>
                <span class="pub-separator">•</span>
                <span class="pub-journal-ko">{pub.journal}</span>
                {pub.journal_en && <span class="pub-journal-en">({pub.journal_en})</span>}
                <span class="pub-separator">•</span>
                <span class="pub-year">{pub.year}</span>
                {pub.volume && <span class="pub-volume"> {pub.volume}({pub.issue})</span>}
                {pub.pages && <span class="pub-pages">, {pub.pages}</span>}
              </div>
              {pub.abstract && (
                <div class="pub-abstract">{pub.abstract}</div>
              )}
              <div class="pub-footer">
                <span class="pub-badge pub-badge-kci">KCI</span>
                {pub.citations > 0 && (
                  <span class="pub-citations">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <path d="M14 2v6h6"></path>
                      <line x1="16" y1="13" x2="8" y2="13"></line>
                      <line x1="16" y1="17" x2="8" y2="17"></line>
                      <line x1="10" y1="9" x2="8" y2="9"></line>
                    </svg>
                    {pub.citations} citations
                  </span>
                )}
              </div>
            </div>
          ))}
        </div>
      </section>
    )}
  </div>

  <!-- Chart.js -->
  <script is:inline src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

  <script is:inline define:vars={{ citationGraph }}>
    // Citation Graph
    if (citationGraph && citationGraph.length > 0) {
      const ctx = document.getElementById('citationChart');
      if (ctx) {
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: citationGraph.map(d => d.year),
            datasets: [{
              label: 'Citations',
              data: citationGraph.map(d => d.citations),
              backgroundColor: 'rgba(37, 99, 235, 0.7)',
              borderColor: 'rgba(37, 99, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              }
            }
          }
        });
      }
    }

    // Sorting functionality
    const sortButtons = document.querySelectorAll('.sort-button');
    const publicationList = document.getElementById('publication-list');

    sortButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Update active state
        sortButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        const sortType = button.dataset.sort;

        // Get all publication items
        const items = Array.from(publicationList.querySelectorAll('.publication-item'));

        // Sort items
        items.sort((a, b) => {
          if (sortType === 'year') {
            return parseInt(b.dataset.year) - parseInt(a.dataset.year);
          } else if (sortType === 'citations') {
            return parseInt(b.dataset.citations) - parseInt(a.dataset.citations);
          }
          return 0;
        });

        // Re-append items in sorted order
        items.forEach(item => {
          publicationList.appendChild(item);
        });
      });
    });
  </script>
</BaseLayout>
